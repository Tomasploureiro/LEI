<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Googol - Resultados da Pesquisa</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; font-family: Arial, sans-serif; }
        .search-container { background-color: #fff; padding: 20px; border-radius: 8px;
                            box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .result-item { padding: 15px; border-bottom: 1px solid #eee; }
        .result-item:last-child { border-bottom: none; }
        .result-title { color: #1a0dab; font-size: 18px; margin-bottom: 5px; }
        .result-url { color: #006621; font-size: 14px; margin-bottom: 5px; }
        .result-citation { color: #545454; font-size: 14px; }
        .pagination { justify-content: center; }
        /* Mudando cor do box de análise para uma cor mais associada ao Gemini */
        .analysis-box { background-color: #e8f0fe; padding: 15px; border-radius: 8px;
                        margin-bottom: 20px; border-left: 4px solid #8AB4F8; }
        .search-header { display: flex; align-items: center; justify-content: space-between;
                         margin-bottom: 20px; }
        .logo { font-size: 24px; font-weight: bold; }
        .logo span:nth-child(1) { color: #4285f4; }
        .logo span:nth-child(2) { color: #ea4335; }
        .logo span:nth-child(3) { color: #fbbc05; }
        .logo span:nth-child(4) { color: #4285f4; }
        .logo span:nth-child(5) { color: #34a853; }
        .logo span:nth-child(6) { color: #ea4335; }
        /* Adicionando badge do Gemini */
        .gemini-badge { background-color: #8AB4F8; color: #fff; font-size: 12px; padding: 2px 8px;
                        border-radius: 12px; margin-left: 10px; }
    </style>
</head>
<body>
<div class="container mt-4">
    <div class="search-header">
        <div class="logo">
            <span>G</span><span>o</span><span>o</span><span>g</span><span>o</span><span>l</span>
        </div>
        <div>
            <a href="/stats" class="btn btn-outline-secondary btn-sm">Estatísticas</a>
        </div>
    </div>

    <div class="search-container">
        <form action="/search" method="get" class="mb-4">
            <div class="input-group">
                <input type="text" name="query" class="form-control" placeholder="Digite sua pesquisa..."
                       th:value="${query}" required>
                <button type="submit" class="btn btn-primary">Pesquisar</button>
            </div>
        </form>

        <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

        <div th:if="${query != null}">
            <div th:if="${results != null && !results.isEmpty()}">
                <div class="mb-3">
                    <span th:text="${totalResults}">0</span> resultados encontrados para
                    "<span th:text="${query}"></span>"
                </div>

                <div th:if="${analysis}" class="analysis-box mb-4">
                    <h5>Análise Contextual <span class="gemini-badge">Gemini</span></h5>
                    <p th:text="${analysis}"></p>
                </div>

                <form action="/index-hackernews" method="post" class="mb-4">
                    <input type="hidden" name="query" th:value="${query}">
                    <button type="submit" class="btn btn-warning">
                        Indexar URLs relacionados do Hacker News
                    </button>
                </form>

                <div class="result-list">
                    <div th:each="result : ${results}" class="result-item">
                        <div th:with="parts=${result.split(' Titulo: ')}">
                            <div th:with="urlParts=${parts[0].split('URL: ')}">
                                <div th:with="url=${urlParts.length > 1 ? urlParts[1] : urlParts[0]}">
                                    <div th:with="titleParts=${parts.length > 1 ? parts[1].split(' Citacao: ') : null}">
                                        <div class="result-title">
                                            <a th:href="${url}" target="_blank"
                                               th:text="${titleParts != null && titleParts.length > 0 ? titleParts[0] : url}"></a>
                                        </div>
                                        <div class="result-url" th:text="${url}"></div>
                                        <div class="result-citation"
                                             th:text="${titleParts != null && titleParts.length > 1 ? titleParts[1] : ''}"></div>
                                        <div class="mt-2">
                                            <a th:href="@{/backlinks(url=${url})}" class="btn btn-sm btn-outline-info">
                                                Ver backlinks
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <nav th:if="${totalPages > 1}" class="mt-4">
                    <!-- Paginação (sem alterações) -->
                </nav>
            </div>

            <!-- Botão visível mesmo sem resultados -->
            <form th:if="${results == null || results.isEmpty()}" action="/index-hackernews" method="post" class="text-center py-5">
                <input type="hidden" name="query" th:value="${query}">
                <button type="submit" class="btn btn-warning">
                    Pesquisar e Indexar URLs relacionados do Hacker News
                </button>
                <p class="mt-3">Nenhum resultado encontrado. Clique acima para tentar encontrar URLs relacionados no Hacker News.</p>
            </form>
        </div>
    </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
</body>
</html>